

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart &mdash; presamples 0.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using presamples with brightway2" href="use_with_bw2.html" />
    <link rel="prev" title="Installing" href="installing.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> presamples
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-objectives-of-presamples">The objectives of presamples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-example-fertilizer-inputs-to-cereal-production-in-canada">Simple example: Fertilizer inputs to cereal production in Canada</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-presample-packages-for-data-inputs">Creating presample packages for data inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#direct-interface-to-presamples-package">Direct interface to presamples package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-packages-for-use-one-column-at-a-time">Loading packages for use one column at a time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storing-a-model-s-output-as-a-presample-package">Storing a model’s output as a presample package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-presample-packages-with-seeded-indexers">Creating presample packages with seeded indexers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-presample-packages-with-sequential-indexers">Creating presample packages with sequential indexers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-presamples-to-override-input-values">Using presamples to override input values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storing-a-presample-resource">Storing a presample resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-campaigns-to-manage-sets-of-presample-packages">Using <code class="docutils literal notranslate"><span class="pre">Campaigns</span></code> to manage sets of presample packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="use_with_bw2.html">Using presamples with brightway2</a></li>
<li class="toctree-l1"><a class="reference internal" href="tech_ref.html">Technical reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="pubs.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html#authors">Authors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">presamples</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<span id="id1"></span><h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p>This section provides a brief overview of the use of presamples for named parameters via a simple example.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#objectives"><span class="std std-ref">The objectives of presamples</span></a></p></li>
<li><p><a class="reference internal" href="#simple-example"><span class="std std-ref">Simple example: Fertilizer inputs to cereal production in Canada</span></a></p></li>
<li><p><a class="reference internal" href="#creating-presamples"><span class="std std-ref">Creating presample packages for data inputs</span></a></p></li>
<li><p><a class="reference internal" href="#accessing-package"><span class="std std-ref">Direct interface to presamples package</span></a></p></li>
<li><p><a class="reference internal" href="#loading-package"><span class="std std-ref">Loading packages for use one column at a time</span></a></p></li>
<li><p><a class="reference internal" href="#storing-model-results"><span class="std std-ref">Storing a model’s output as a presample package</span></a></p></li>
<li><p><a class="reference internal" href="#storing-resource"><span class="std std-ref">Storing a presample resource</span></a></p></li>
<li><p><a class="reference internal" href="#seeded-indexers"><span class="std std-ref">Creating presample packages with seeded indexers</span></a></p></li>
<li><p><a class="reference internal" href="#sequential-indexers"><span class="std std-ref">Creating presample packages with sequential indexers</span></a></p></li>
<li><p><a class="reference internal" href="#override-parameter-values"><span class="std std-ref">Using presamples to override input values</span></a></p></li>
<li><p><a class="reference internal" href="#managing-using-campaigns"><span class="std std-ref">Using Campaigns to manage sets of presample packages</span></a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While presamples are application-agnostic, the package was developed in
the context of the <a class="reference external" href="https://brightwaylca.org/">Brightway2 LCA framework</a>.
If you are interested in using presamples for LCA and are new to presamples,
you should move on to <a class="reference internal" href="use_with_bw2.html#use-with-bw2"><span class="std std-ref">Using presamples with brightway2</span></a> after reading this section.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section really only provides a brief overview. For a more in-depth presentation
of the API, read the <a class="reference internal" href="tech_ref.html#tech-ref"><span class="std std-ref">Technical reference</span></a> section.
Also, the examples in this section are minimalistic. For some more concrete examples,
refer to the <a class="reference internal" href="examples.html#examples"><span class="std std-ref">Examples</span></a> section.</p>
</div>
<div class="section" id="the-objectives-of-presamples">
<span id="objectives"></span><h2>The objectives of presamples<a class="headerlink" href="#the-objectives-of-presamples" title="Permalink to this headline">¶</a></h2>
<p>Presamples was written to meet two specific needs:
- the need to store and provide access to arrays of data that are inputs to a model;
- the need to have a flexible data hierarchy so that some arrays can be replaced
by other arrays when running a model.</p>
<p>Presamples is used to write, load, manage and verify <em>presample arrays</em>, which are
simply arrays of values specific parameters can take. These are stored in
<em>presample packages</em>, which are based on the <a class="reference external" href="https://frictionlessdata.io/specs/data-package/">datapackage standard</a>
by the <a class="reference external" href="https://okfn.org/projects/">Open Knowledge Foundation</a>.</p>
<p>These presample arrays can be based on any source:</p>
<blockquote>
<div><ul class="simple">
<li><p>Measured data;</p></li>
<li><p>Time series data from a statistical agency;</p></li>
<li><p>Array of random values generated from a given distribution;</p></li>
<li><p>The output from a MonteCarlo Simulation from a model;</p></li>
<li><p>A hat.</p></li>
</ul>
</div></blockquote>
<p>Presamples allows these arrays to be generated <em>ahead</em> of their use in a particular model. This is useful if:</p>
<blockquote>
<div><ul class="simple">
<li><p>Generating these values is computationally expensive and there is no need to recalculate them with each model run;</p></li>
<li><p>We want to reuse the <em>same</em> values every time a model is solved.</p></li>
</ul>
</div></blockquote>
<p>Also, when multiple presample packages are accessed for a single parameter, only the last
values are used. This allows a baseline model to be modulated with different input
data (scenarios) without actually making changes to the baseline data.</p>
</div>
<div class="section" id="simple-example-fertilizer-inputs-to-cereal-production-in-canada">
<span id="simple-example"></span><h2>Simple example: Fertilizer inputs to cereal production in Canada<a class="headerlink" href="#simple-example-fertilizer-inputs-to-cereal-production-in-canada" title="Permalink to this headline">¶</a></h2>
<p>For illustration, let’s suppose you have a simple model that calculates the amount of fertilizer used to grow
1 kg of cereals in Canada. The model has three inputs:</p>
<blockquote>
<div><ul class="simple">
<li><p>Total amount of fertilizers used per km2 for a given year</p></li>
<li><p>The total land under cultivation for the same year</p></li>
<li><p>The total output of cereals for the same year</p></li>
</ul>
</div></blockquote>
<p>The model is simply:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">fert_per_kg</span><span class="p">(</span><span class="n">fert_kg_per_km2</span><span class="p">,</span> <span class="n">land_ha</span><span class="p">,</span> <span class="n">cereal_t</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">fert_kg_per_km2</span> <span class="o">*</span> <span class="p">(</span><span class="n">land_ha</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cereal_t</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>The following data, stored as arrays, were collected for years 2003-2015 from the
<a class="reference external" href="https://data.worldbank.org/">World Bank website</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="go"># Cereal production, in metric tons</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cereal_production_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="mi">49197200</span><span class="p">,</span> <span class="mi">50778200</span><span class="p">,</span> <span class="mi">50962400</span><span class="p">,</span> <span class="mi">48577300</span><span class="p">,</span> <span class="mi">48005300</span><span class="p">,</span> <span class="mi">56030400</span><span class="p">,</span>
<span class="gp">... </span>        <span class="mi">49691900</span><span class="p">,</span> <span class="mi">45793400</span><span class="p">,</span> <span class="mi">47667200</span><span class="p">,</span> <span class="mi">51799100</span><span class="p">,</span> <span class="mi">66405701</span><span class="p">,</span> <span class="mi">51535801</span><span class="p">,</span> <span class="mi">53361100</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go"># Fertilizer consumption, in kg/km^2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fertilizer_consumption_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span><span class="mf">57.63016664</span><span class="p">,</span>   <span class="mf">58.92761065</span><span class="p">,</span>   <span class="mf">54.63277483</span><span class="p">,</span>   <span class="mf">61.82127866</span><span class="p">,</span>   <span class="mf">46.99494591</span><span class="p">,</span>
<span class="gp">... </span>     <span class="mf">68.60414475</span><span class="p">,</span>   <span class="mf">63.96407104</span><span class="p">,</span>   <span class="mf">62.20875736</span><span class="p">,</span>   <span class="mf">62.26266793</span><span class="p">,</span>   <span class="mf">77.0963275</span> <span class="p">,</span>
<span class="gp">... </span>     <span class="mf">94.15242211</span><span class="p">,</span>   <span class="mf">96.13617882</span><span class="p">,</span>   <span class="mf">115.82229301</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go"># Land used for cereal production, in hectares</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">land_for_cereals_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="mi">17833000</span><span class="p">,</span> <span class="mi">16161700</span><span class="p">,</span> <span class="mi">15846800</span><span class="p">,</span> <span class="mi">15946100</span><span class="p">,</span> <span class="mi">16145100</span><span class="p">,</span> <span class="mi">16519700</span><span class="p">,</span>
<span class="gp">... </span>        <span class="mi">15060300</span><span class="p">,</span> <span class="mi">13156000</span><span class="p">,</span> <span class="mi">13536700</span><span class="p">,</span> <span class="mi">14981496</span><span class="p">,</span> <span class="mi">15924684</span><span class="p">,</span> <span class="mi">14023084</span><span class="p">,</span> <span class="mi">14581100</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-presample-packages-for-data-inputs">
<span id="creating-presamples"></span><h2>Creating presample packages for data inputs<a class="headerlink" href="#creating-presample-packages-for-data-inputs" title="Permalink to this headline">¶</a></h2>
<p>To create a presamples package for the input data described above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">presamples</span>

<span class="go"># Stack arrays of data.</span>
<span class="go"># The number of columns equals the number of observations</span>
<span class="go"># The number of rows equals the number of parameters</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_sample_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">cereal_production_array</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">fertilizer_consumption_array</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">land_for_cereals_array</span>
<span class="gp">... </span>    <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
<span class="gp">... </span><span class="p">)</span>

<span class="go"># Create a list of your parameter names</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cereal production [t]&#39;</span><span class="p">,</span> <span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">,</span> <span class="s1">&#39;land [ha]&#39;</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">pp_id</span><span class="p">,</span> <span class="n">pp_path</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">create_presamples_package</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parameter_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ag_sample_arr</span><span class="p">,</span> <span class="n">ag_names</span><span class="p">,</span> <span class="s2">&quot;Agri baseline data&quot;</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Baseline agri data - presample package&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This function does several things:</p>
<ol class="arabic simple">
<li><p>It stores the samples to a numpy array and the parameter names as a json file to disk, at the location <code class="docutils literal notranslate"><span class="pre">pp_path</span></code></p></li>
<li><p>It generates a file <code class="docutils literal notranslate"><span class="pre">datapackage.json</span></code> that contains metadata on the presamples package.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">pp_path</span><span class="p">)</span>
<span class="go">[&#39;datapackage.json&#39;,</span>
<span class="go"> &#39;dbc8f4abb93540f9a1ab040b8923672f.0.names.json&#39;,</span>
<span class="go"> &#39;dbc8f4abb93540f9a1ab040b8923672f.0.samples.npy&#39;]</span>
</pre></div>
</div>
<p>The datapackage has the following structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pp_path</span><span class="o">/</span><span class="s1">&#39;datapackage.json&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">datapackage</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">datapackage</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="go">{</span>
<span class="go">    &quot;name&quot;: &quot;Baseline agri data - presample package&quot;,</span>
<span class="go">    &quot;id&quot;: &quot;dbc8f4abb93540f9a1ab040b8923672f&quot;,</span>
<span class="go">    &quot;profile&quot;: &quot;data-package&quot;,</span>
<span class="go">    &quot;seed&quot;: null,</span>
<span class="go">    &quot;resources&quot;: [</span>
<span class="go">        {</span>
<span class="go">            &quot;samples&quot;: {</span>
<span class="go">                &quot;filepath&quot;: &quot;dbc8f4abb93540f9a1ab040b8923672f.0.samples.npy&quot;,</span>
<span class="go">                &quot;md5&quot;: &quot;58978441f250cadca1d5829110d23942&quot;,</span>
<span class="go">                &quot;shape&quot;: [</span>
<span class="go">                    3,</span>
<span class="go">                    13</span>
<span class="go">                ],</span>
<span class="go">                &quot;dtype&quot;: &quot;float64&quot;,</span>
<span class="go">                &quot;format&quot;: &quot;npy&quot;,</span>
<span class="go">                &quot;mediatype&quot;: &quot;application/octet-stream&quot;</span>
<span class="go">            },</span>
<span class="go">            &quot;names&quot;: {</span>
<span class="go">                &quot;filepath&quot;: &quot;dbc8f4abb93540f9a1ab040b8923672f.0.names.json&quot;,</span>
<span class="go">                &quot;md5&quot;: &quot;c2202d5f8fd5fd9eb11e3cd528b6b14d&quot;,</span>
<span class="go">                &quot;format&quot;: &quot;json&quot;,</span>
<span class="go">                &quot;mediatype&quot;: &quot;application/json&quot;</span>
<span class="go">            },</span>
<span class="go">            &quot;profile&quot;: &quot;data-resource&quot;,</span>
<span class="go">            &quot;label&quot;: &quot;Agri baseline data&quot;,</span>
<span class="go">            &quot;index&quot;: 0</span>
<span class="go">        }</span>
<span class="go">    ],</span>
<span class="go">    &quot;ncols&quot;: 13</span>
<span class="go">}</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="tech_ref.html#tech-ref"><span class="std std-ref">Technical reference</span></a> for more detail and for a list of other arguments.</p>
</div>
<div class="section" id="direct-interface-to-presamples-package">
<span id="accessing-package"></span><h2>Direct interface to presamples package<a class="headerlink" href="#direct-interface-to-presamples-package" title="Permalink to this headline">¶</a></h2>
<p>To interact directly with a single presamples package :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">package</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PresamplesPackage</span><span class="p">(</span><span class="n">pp_path</span><span class="p">)</span>
</pre></div>
</div>
<p>The entire content of the <code class="docutils literal notranslate"><span class="pre">datapackage.json</span></code> file is returned by <code class="docutils literal notranslate"><span class="pre">package.metadata</span></code>.</p>
<p>The package can also be used to directly return several properties contained in the datapackage, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># Name passed as optional argument in ``create_presamples_package``</span>
<span class="go">&#39;Agri example - baseline data&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">ncols</span> <span class="c1"># Number of columns, i.e. number of observations stored in the presamples array</span>
<span class="go">13</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">id</span>
<span class="go">&#39;2a31aa637f564618bf5e606333ffb7fc&#39;</span>
</pre></div>
</div>
<p>Accessing the package’s <code class="docutils literal notranslate"><span class="pre">resources</span></code> provides metadata on the stored data and filepaths to access it.
<code class="docutils literal notranslate"><span class="pre">packages.resources</span></code> returns a list with as many resources as were passed in <code class="docutils literal notranslate"><span class="pre">create_presamples_package</span></code>. In our
simple example, only one set of parameter data was passed, so <code class="docutils literal notranslate"><span class="pre">packages.resources</span></code> only contains one element.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">resources</span> <span class="c1"># List of resources, in simple example there is one</span>
<span class="go">[{&#39;samples&#39;: {&#39;filepath&#39;: &#39;dbc8f4abb93540f9a1ab040b8923672f.0.samples.npy&#39;,</span>
<span class="go">   &#39;md5&#39;: &#39;58978441f250cadca1d5829110d23942&#39;,</span>
<span class="go">   &#39;shape&#39;: [3, 13],</span>
<span class="go">   &#39;dtype&#39;: &#39;float64&#39;,</span>
<span class="go">   &#39;format&#39;: &#39;npy&#39;,</span>
<span class="go">   &#39;mediatype&#39;: &#39;application/octet-stream&#39;},</span>
<span class="go">  &#39;names&#39;: {&#39;filepath&#39;: &#39;dbc8f4abb93540f9a1ab040b8923672f.0.names.json&#39;,</span>
<span class="go">   &#39;md5&#39;: &#39;c2202d5f8fd5fd9eb11e3cd528b6b14d&#39;,</span>
<span class="go">   &#39;format&#39;: &#39;json&#39;,</span>
<span class="go">   &#39;mediatype&#39;: &#39;application/json&#39;},</span>
<span class="go">  &#39;profile&#39;: &#39;data-resource&#39;,</span>
<span class="go">  &#39;label&#39;: &#39;Agri baseline data&#39;,</span>
<span class="go">  &#39;index&#39;: 0}]</span>
</pre></div>
</div>
<p>The PresamplesPackage also provides a <code class="docutils literal notranslate"><span class="pre">ParametersMapping</span></code> interface to access named parameter data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">parameters</span>
<span class="go">&lt;presamples.package_interface.ParametersMapping at 0x2136d4de5f8&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;cereal production [t]&#39;, &#39;fert consumption [kg/km2]&#39;, &#39;land [ha]&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="c1"># Note that the arrays are memory mapped</span>
<span class="go"> [memmap([49197200., 50778200., 50962400., 48577300., 48005300., 56030400.,</span>
<span class="go">          49691900., 45793400., 47667200., 51799100., 66405701., 51535801.,</span>
<span class="go">          53361100.]),</span>
<span class="go"> memmap([ 57.63016664,  58.92761065,  54.63277483,  61.82127866,</span>
<span class="go">          46.99494591,  68.60414475,  63.96407104,  62.20875736,</span>
<span class="go">          62.26266793,  77.0963275 ,  94.15242211,  96.13617882,</span>
<span class="go">          115.82229301]),</span>
<span class="go"> memmap([17833000., 16161700., 15846800., 15946100., 16145100., 16519700.,</span>
<span class="go">         15060300., 13156000., 13536700., 14981496., 15924684., 14023084.,</span>
<span class="go">         14581100.])]</span>

<span class="go"> &gt;&gt;&gt; {k:v for k, v in package.parameters.items()}</span>
<span class="go"> {&#39;cereal production [t]&#39;: memmap([49197200., 50778200., 50962400., 48577300., 48005300., 56030400.,</span>
<span class="go">         49691900., 45793400., 47667200., 51799100., 66405701., 51535801.,</span>
<span class="go">         53361100.]),</span>
<span class="go"> &#39;fert consumption [kg/km2]&#39;: memmap([ 57.63016664,  58.92761065,  54.63277483,  61.82127866,</span>
<span class="go">          46.99494591,  68.60414475,  63.96407104,  62.20875736,</span>
<span class="go">          62.26266793,  77.0963275 ,  94.15242211,  96.13617882,</span>
<span class="go">         115.82229301]),</span>
<span class="go"> &#39;land [ha]&#39;: memmap([17833000., 16161700., 15846800., 15946100., 16145100., 16519700.,</span>
<span class="go">         15060300., 13156000., 13536700., 14981496., 15924684., 14023084.,</span>
<span class="go">         14581100.])}</span>
</pre></div>
</div>
<p>You can also get a specific array directly from the parameter name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">package</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;land [ha]&#39;</span><span class="p">]</span>
<span class="go">memmap([17833000., 16161700., 15846800., 15946100., 16145100., 16519700.,</span>
<span class="go">        15060300., 13156000., 13536700., 14981496., 15924684., 14023084.,</span>
<span class="go">        14581100.])</span>
</pre></div>
</div>
<p>Note that the values from <strong>all</strong> columns are returned, which makes the <code class="docutils literal notranslate"><span class="pre">PresamplePackages</span></code> a useful interface
for models that accept arrays as inputs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fert_per_kg</span><span class="p">(</span>
<span class="go">        fert_kg_per_km2=package.parameters[&#39;fert consumption [kg/km2]&#39;],</span>
<span class="go">        land_ha=package.parameters[&#39;land [ha]&#39;],</span>
<span class="go">        cereal_t=package.parameters[&#39;cereal production [t]&#39;]</span>
<span class="go">    )</span>
<span class="go">array([208.89781567, 187.55496749, 169.88106058, 202.93599925,</span>
<span class="go">       158.05298607, 202.26874876, 193.85817388, 178.71973075,</span>
<span class="go">       176.8157259 , 222.98038423, 225.78597129, 261.59013441,</span>
<span class="go">       316.48831014])</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-packages-for-use-one-column-at-a-time">
<span id="loading-package"></span><h2>Loading packages for use one column at a time<a class="headerlink" href="#loading-packages-for-use-one-column-at-a-time" title="Permalink to this headline">¶</a></h2>
<p>Presamples also allows accessing parameter data one observation at a time. This is useful to feed data from the presample
arrays in Monte Carlo Simulations.</p>
<p>This is done via the <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code>. A <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> is instantiated with a list of presamples package
paths. In our simple example, we just have one path:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">pp_path</span><span class="p">])</span>
</pre></div>
</div>
<p>One of the important things the <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> does in create an <code class="docutils literal notranslate"><span class="pre">Indexer</span></code> for each presamples package. This indexer
simply returns an integer representing the column number of the presamples array from which data should be taken.
By default, the <code class="docutils literal notranslate"><span class="pre">Indexer</span></code> returns indices at random. An <code class="docutils literal notranslate"><span class="pre">Indexer</span></code> can also be seeded for reproducibility (see
<a class="reference internal" href="#seeded-indexers"><span class="std std-ref">Creating presample packages with seeded indexers</span></a>), and can also return values sequentially (see <a class="reference internal" href="#sequential-indexers"><span class="std std-ref">Creating presample packages with sequential indexers</span></a>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> has an interface to access named parameters, one observation at a time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;land [ha]&#39;</span><span class="p">]</span>
<span class="go">17833000.0</span>
</pre></div>
</div>
<p>It is also possible to return values for all parameters using the <code class="docutils literal notranslate"><span class="pre">consolidated_arrays</span></code> property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="go">array([4.91972000e+07, 5.76301666e+01, 1.78330000e+07])</span>
</pre></div>
</div>
<p>The order of the values is identical to the order of names:
.. code-block:: python</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">names</span>
<span class="go">[&#39;cereal production [t]&#39;, &#39;fert consumption [kg/km2]&#39;, &#39;land [ha]&#39;]</span>
</pre></div>
</div>
<p>The array is considered “consolidated” because it uses values from all packages passed to the <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code>. In
this simple example, only one was passed, so not much was consolidated, but the interest of consolidating is explained in
<a class="reference internal" href="#override-parameter-values"><span class="std std-ref">Using presamples to override input values</span></a>.</p>
<p>To move to the next (random) observation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="go">array([5.33611000e+07, 1.15822293e+02, 1.45811000e+07])</span>
</pre></div>
</div>
<p>The index value of each package’s <code class="docutils literal notranslate"><span class="pre">Indexer</span></code> can be returned using the <code class="docutils literal notranslate"><span class="pre">consolidated_index</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;values:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">ag_loader</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span> <span class="c1"># Move to the next (random) index</span>
<span class="go">indices: [12, 12, 12] values: [5.33611000e+07 1.15822293e+02 1.45811000e+07]</span>
<span class="go">indices: [8, 8, 8] values: [4.76672000e+07 6.22626679e+01 1.35367000e+07]</span>
<span class="go">indices: [5, 5, 5] values: [5.60304000e+07 6.86041448e+01 1.65197000e+07]</span>
<span class="go">indices: [0, 0, 0] values: [4.91972000e+07 5.76301666e+01 1.78330000e+07]</span>
</pre></div>
</div>
<p>The indices are all the same because the <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> was populated with a single presamples package.</p>
<p>To use these in our model described in the <a class="reference internal" href="#simple-example">simple_example</a> section:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">run_nb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Run the model 5 times</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Run number:&quot;</span><span class="p">,</span> <span class="n">run_nb</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="c1"># Update the index, i.e. move to the next random index</span>
<span class="gp">... </span>    <span class="n">ag_loader</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="go"># Calculate the model output using sampled parameter values</span>
<span class="gp">... </span>    <span class="n">fertilizer_amount</span> <span class="o">=</span> <span class="n">fert_per_kg</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">fert_kg_per_km2</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">land_ha</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">cereal_t</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;cereal production [t]&#39;</span><span class="p">]</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># print the sampled column index and the model output for each run</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">indices:&quot;</span><span class="p">,</span> <span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">result:&quot;</span><span class="p">,</span>  <span class="s1">&#39;{:.2e}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fertilizer_amount</span><span class="p">))</span>
<span class="go">Run number: 0</span>
<span class="go">    indices: [1, 1, 1]</span>
<span class="go">    result: 6.84e-04</span>
<span class="go">Run number: 1</span>
<span class="go">    indices: [4, 4, 4]</span>
<span class="go">    result: 4.60e-04</span>
<span class="go">Run number: 2</span>
<span class="go">    indices: [9, 9, 9]</span>
<span class="go">    result: 1.15e-03</span>
<span class="go">Run number: 3</span>
<span class="go">    indices: [5, 5, 5]</span>
<span class="go">    result: 8.40e-04</span>
<span class="go">Run number: 4</span>
<span class="go">    indices: [9, 9, 9]</span>
<span class="go">    result: 1.15e-03</span>
</pre></div>
</div>
</div>
<div class="section" id="storing-a-model-s-output-as-a-presample-package">
<span id="storing-model-results"></span><h2>Storing a model’s output as a presample package<a class="headerlink" href="#storing-a-model-s-output-as-a-presample-package" title="Permalink to this headline">¶</a></h2>
<p>The calculated model output (in the example, kg fertilizer per kg cereal) may be an input to another model.
It would be possible to store the calculated output of our model as yet another presample package, and to use this
directly in the other model.</p>
<p>While this example is simple, it is rather obvious that this can be a great advantage for larger models that take take
a lot of computing resources.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Number of iterations to store.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ag_loader</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">model_output</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fert_per_kg</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">fert_kg_per_km2</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">land_ha</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">cereal_t</span><span class="o">=</span><span class="n">ag_loader</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;cereal production [t]&#39;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model_output</span>
<span class="go">array([[0.00133493, 0.00078676, 0.00081327, ..., 0.00078676, 0.00058567,</span>
<span class="go">        0.00084508  ]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_result_pp_id</span><span class="p">,</span> <span class="n">ag_result_pp_fp</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">create_presamples_package</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parameter_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">model_output</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;fert_input_per_kg_cereal&#39;</span><span class="p">],</span> <span class="s2">&quot;Agri model output baseline&quot;</span><span class="p">)],</span>
<span class="go">        name=&quot;baseline_model_output&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>This presample package can then be accessed or used as described above.</p>
</div>
<div class="section" id="creating-presample-packages-with-seeded-indexers">
<span id="seeded-indexers"></span><h2>Creating presample packages with seeded indexers<a class="headerlink" href="#creating-presample-packages-with-seeded-indexers" title="Permalink to this headline">¶</a></h2>
<p>Indexers are by default random. To force the indices to be returned in the same order everytime a presamples package is
used, it is possible to specify a <code class="docutils literal notranslate"><span class="pre">seed</span></code> when creating the presamples package. This will ensure repeatability across
uses of the presample package.</p>
<p>Reusing the original data, we simply pass a seed when using <code class="docutils literal notranslate"><span class="pre">create_presamples_package</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pp_id_seeded</span><span class="p">,</span> <span class="n">pp_path_seeded</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">create_presamples_package</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parameter_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ag_sample_arr</span><span class="p">,</span> <span class="n">ag_names</span><span class="p">,</span> <span class="s2">&quot;Agri baseline data&quot;</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>We can test that this worked by creating two <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> objects and making sure they return samples in the
same order:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a first loader and print indices and values</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ag_loader_seeded_1</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">ag_fp_seeded</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ag_loader_seeded_2</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">ag_fp_seeded</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ag_loader_seeded_1</span> <span class="ow">is</span> <span class="n">ag_loader_seeded_2</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ag_loader_seeded_1</span> <span class="o">==</span> <span class="n">ag_loader_seeded_2</span>
<span class="bp">False</span>
</pre></div>
</div>
<p>The two loaders are distinct, and yet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ag_loader_seeded_1</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seeded_1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;values:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seeded_1</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="go">indices: [5, 5, 5] values: [5.60304000e+07 6.86041448e+01 1.65197000e+07]</span>
<span class="go">indices: [10, 10, 10] values: [6.64057010e+07 9.41524221e+01 1.59246840e+07]</span>
<span class="go">indices: [8, 8, 8] values: [4.76672000e+07 6.22626679e+01 1.35367000e+07]</span>
<span class="go">indices: [4, 4, 4] values: [4.80053000e+07 4.69949459e+01 1.61451000e+07]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">ag_loader_seeded_2</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seeded_2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;values:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seeded_2</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="go">indices: [5, 5, 5] values: [5.60304000e+07 6.86041448e+01 1.65197000e+07]</span>
<span class="go">indices: [10, 10, 10] values: [6.64057010e+07 9.41524221e+01 1.59246840e+07]</span>
<span class="go">indices: [8, 8, 8] values: [4.76672000e+07 6.22626679e+01 1.35367000e+07]</span>
<span class="go">indices: [4, 4, 4] values: [4.80053000e+07 4.69949459e+01 1.61451000e+07]</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-presample-packages-with-sequential-indexers">
<span id="sequential-indexers"></span><h2>Creating presample packages with sequential indexers<a class="headerlink" href="#creating-presample-packages-with-sequential-indexers" title="Permalink to this headline">¶</a></h2>
<p>It can often be useful to sample values sequentially. To do so, pass <code class="docutils literal notranslate"><span class="pre">seed=sequential</span></code> when creating the presamples package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pp_id_seq</span><span class="p">,</span> <span class="n">pp_path_seq</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">create_presamples_package</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parameter_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ag_sample_arr</span><span class="p">,</span> <span class="n">ag_names</span><span class="p">,</span> <span class="s2">&quot;Agri baseline data&quot;</span><span class="p">)],</span>
<span class="gp">... </span>    <span class="n">seed</span><span class="o">=</span><span class="s1">&#39;sequential&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader_seq</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">ag_fp_seq</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seq</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;values:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_seq</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">ag_loader_seq</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="go">indices: [0, 0, 0] values: [4.91972000e+07 5.76301666e+01 1.78330000e+07]</span>
<span class="go">indices: [1, 1, 1] values: [5.07782000e+07 5.89276106e+01 1.61617000e+07]</span>
<span class="go">indices: [2, 2, 2] values: [5.09624000e+07 5.46327748e+01 1.58468000e+07]</span>
<span class="go">indices: [3, 3, 3] values: [4.85773000e+07 6.18212787e+01 1.59461000e+07]</span>
</pre></div>
</div>
</div>
<div class="section" id="using-presamples-to-override-input-values">
<span id="override-parameter-values"></span><h2>Using presamples to override input values<a class="headerlink" href="#using-presamples-to-override-input-values" title="Permalink to this headline">¶</a></h2>
<p>Multiple presamples packages can be passed to a single <code class="docutils literal notranslate"><span class="pre">DataPackageLoader</span></code>. When a named parameted is present in more
than one presamples package, only the value in the last package to have the named parameter is used.  This allows for
easily updating input data.</p>
<p>In our example, say we want to fix the fertilizer use parameter to an amount representing a specific scenario:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_fertilizer_amount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">60</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># The array MUST have one row, as we only have one parameter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fert_scenario_id</span><span class="p">,</span> <span class="n">fert_scenario_path</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">create_presamples_package</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">parameter_data</span><span class="o">=</span><span class="p">[</span><span class="n">new_fertilizer_amount</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;fert consumption [kg/km2]&#39;</span><span class="p">],</span> <span class="s1">&#39;ag scenario 1&#39;</span><span class="p">]),</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario 1 agri data - presample package&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>We can now create a loader where both the baseline and the scenario packages are passed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_loader_scenario</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">pp_path</span><span class="p">,</span> <span class="n">fert_scenario_loader</span><span class="p">])</span>
</pre></div>
</div>
<p>We can see that the original values for fertilizer use have been replaced by those in the new package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_scenario</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;values:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">ag_loader_scenario</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">... </span>    <span class="n">ag_loader_scenario</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="go">indices: [6, 0, 6] values: [4.96919e+07 6.00000e+01 1.50603e+07]</span>
<span class="go">indices: [11, 0, 11] values: [5.1535801e+07 6.0000000e+01 1.4023084e+07]</span>
<span class="go">indices: [1, 0, 1] values: [5.07782e+07 6.00000e+01 1.61617e+07]</span>
<span class="go">indices: [11, 0, 11] values: [5.1535801e+07 6.0000000e+01 1.4023084e+07]</span>
</pre></div>
</div>
<p>Notice that the index for the second parameter (‘fert consumption [kg/km2]’) is always 0: this is because the package
for this named parameter only has one column.</p>
<p>You can pass as many packages as required, and each package can have any number of named parameters and observations
(columns).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When passing multiple presamples package paths to a single <code class="docutils literal notranslate"><span class="pre">DataPackageLoader</span></code>, named parameters get their values and
indices from the last presamples package that contains data on this named parameter.</p>
</div>
</div>
<div class="section" id="storing-a-presample-resource">
<span id="storing-resource"></span><h2>Storing a presample resource<a class="headerlink" href="#storing-a-presample-resource" title="Permalink to this headline">¶</a></h2>
<p>In order to facilitate their retrieval for reuse, references to presamples packages can be stored in a database
<code class="docutils literal notranslate"><span class="pre">campaigns.db</span></code>. Interaction with this database is based on the <a class="reference external" href="http://docs.peewee-orm.com/en/latest/">Peewee ORM</a>.</p>
<p>The first table of this database is the <code class="docutils literal notranslate"><span class="pre">PresampleResource</span></code> table, used to store references to presamples packages.</p>
<p>To store a reference to a presample package in the database:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pr_baseline</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PresampleResource</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Baseline agri data&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">path</span><span class="o">=</span><span class="n">pp_path</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The resource has a few useful properties, such as <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">path</span></code>.</p>
<p>One can then retrieve a presample resource based on the name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pr_baseline_retrieved</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PresampleResource</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">presamples</span><span class="o">.</span><span class="n">PresampleResource</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s2">&quot;Baseline agri data&quot;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr_baseline</span> <span class="o">==</span> <span class="n">pr_baseline_retrieved</span>
<span class="go">True</span>
</pre></div>
</div>
<p>and then use the associated presample package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">other_loader</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">([</span><span class="n">pr_baseline</span><span class="o">.</span><span class="n">path</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="using-campaigns-to-manage-sets-of-presample-packages">
<span id="managing-using-campaigns"></span><h2>Using <code class="docutils literal notranslate"><span class="pre">Campaigns</span></code> to manage sets of presample packages<a class="headerlink" href="#using-campaigns-to-manage-sets-of-presample-packages" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Campaign</span></code> database also has a table called <code class="docutils literal notranslate"><span class="pre">Campaign</span></code>, used to store information about ordered collections
of <code class="docutils literal notranslate"><span class="pre">PresampleResources</span></code>.</p>
<p>To create a new campaign:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_baseline</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">Campaign</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Agricultural baseline campaign&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_baseline</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="go">1</span>
</pre></div>
</div>
<p>The 1 indicates that one row was changed in the <code class="docutils literal notranslate"><span class="pre">Campaign</span></code> table.</p>
<p>We can add our samples of baseline values using the <code class="docutils literal notranslate"><span class="pre">PresampleResource</span></code> that was created earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_baseline</span><span class="o">.</span><span class="n">add_presample_resource</span><span class="p">(</span><span class="n">pr_baseline</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_baseline</span> <span class="c1">#Get some information on the campaign</span>
<span class="go">&lt;Campaign: Campaign Agricultural baseline campaign with no parent and 1 packages&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ag_campaign_baseline</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span> <span class="c1"># List packages used in campaign</span>
<span class="go">[&#39;Baseline agri data&#39;]</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">Campaign</span></code> can be passed directly to a <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">loader</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">(</span><span class="n">ag_campaign_baseline</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">loader</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="go">array([6.64057010e+07, 9.41524221e+01, 1.59246840e+07])</span>
</pre></div>
</div>
<p>More interestingly, a <code class="docutils literal notranslate"><span class="pre">Campaign</span></code> can point to multiple <code class="docutils literal notranslate"><span class="pre">PresampleResources</span></code> in the desired order. Let’s add the
scenario data we had above to a <code class="docutils literal notranslate"><span class="pre">PresampleResource</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pr_scenario</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PresampleResource</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">path</span><span class="o">=</span><span class="n">fert_scenario_path</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Scenario 1 agri data&quot;</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>Next we create a <em>child</em> Campaign based on the baseline campaign we created above. This child campaign
will automatically point to all the resources of the parent Campaign. Note that you can have an arbitrary
number of descendents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_scenario1</span> <span class="o">=</span> <span class="n">ag_campaign_baseline</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="s2">&quot;Agricultural scenario 1 campaign&quot;</span><span class="p">)</span> <span class="c1"># Create a child campaign</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_scenario1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_scenario1</span><span class="o">.</span><span class="n">add_presample_resource</span><span class="p">(</span><span class="n">pr_scenario</span><span class="p">)</span> <span class="c1"># Add the scenario presample resource</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ag_scenario</span></code> <code class="docutils literal notranslate"><span class="pre">Campaign</span></code> has the baseline data as parent (it will use all its presample packages) and another
package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ag_campaign_scenario1</span>
<span class="go">&lt;Campaign: Campaign Agricultural scenario 1 campaign with parent Agricultural baseline campaign and 2 packages&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ag_campaign_scenario1</span><span class="o">.</span><span class="n">ancestors</span><span class="p">]</span>
<span class="go">[&#39;Agricultural baseline campaign&#39;]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ag_campaign_scenario1</span><span class="o">.</span><span class="n">packages</span><span class="p">]</span>
<span class="go">[&#39;Baseline agri data&#39;, &#39;Scenario 1 agri data&#39;]</span>
</pre></div>
</div>
<p>Using the campaign in a <code class="docutils literal notranslate"><span class="pre">PackagesDataLoader</span></code> will call the presample packages in the expected order, i.e. from the
package with baseline data (added first) to the scenario data (added after):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">loader_scenario</span> <span class="o">=</span> <span class="n">presamples</span><span class="o">.</span><span class="n">PackagesDataLoader</span><span class="p">(</span><span class="n">ag_campaign_scenario1</span><span class="p">)</span> <span class="c1"># Load</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span> <span class="c1"># Check values for 4 iterations</span>
<span class="gp">... </span>    <span class="n">loader_scenario</span><span class="o">.</span><span class="n">update_package_indices</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span>
<span class="gp">... </span>        <span class="s2">&quot;Indices:&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">loader_scenario</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_indices</span><span class="p">,</span>
<span class="gp">... </span>        <span class="s2">&quot;Values: &quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">loader_scenario</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">consolidated_array</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="go">Indices: [9, 0, 9] Values:  [5.1799100e+07 6.0000000e+01 1.4981496e+07]</span>
<span class="go">Indices: [6, 0, 6] Values:  [4.96919e+07 6.00000e+01 1.50603e+07]</span>
<span class="go">Indices: [2, 0, 2] Values:  [5.09624e+07 6.00000e+01 1.58468e+07]</span>
<span class="go">Indices: [2, 0, 2] Values:  [5.09624e+07 6.00000e+01 1.58468e+07]</span>
</pre></div>
</div>
<p>The scenario data overwrote the fertiliser use data on each iteration.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="use_with_bw2.html" class="btn btn-neutral float-right" title="Using presamples with brightway2" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installing.html" class="btn btn-neutral float-left" title="Installing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pascal Lesage, Chris Mutel

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>